{"code":"import * as tslib_1 from \"tslib\";\r\nimport { getPoseValues } from '../inc/selectors';\r\nexport var resolveProp = function (target, props) {\r\n    return typeof target === 'function' ? target(props) : target;\r\n};\r\nvar poseDefault = function (pose, prop, defaultValue, resolveProps) {\r\n    return pose && pose[prop] !== undefined\r\n        ? resolveProp(pose[prop], resolveProps)\r\n        : defaultValue;\r\n};\r\nvar startChildAnimations = function (children, next, pose, props) {\r\n    var animations = [];\r\n    var delay = poseDefault(pose, 'delayChildren', 0, props);\r\n    var stagger = poseDefault(pose, 'staggerChildren', 0, props);\r\n    var staggerDirection = poseDefault(pose, 'staggerDirection', 1, props);\r\n    var maxStaggerDuration = (children.size - 1) * stagger;\r\n    var generateStaggerDuration = staggerDirection === 1\r\n        ? function (i) { return i * stagger; }\r\n        : function (i) { return maxStaggerDuration - i * stagger; };\r\n    Array.from(children).forEach(function (child, i) {\r\n        animations.push(child.set(next, tslib_1.__assign({}, props, { delay: delay + generateStaggerDuration(i) })));\r\n    });\r\n    return animations;\r\n};\r\nvar resolveTransition = function (transition, key, value, props, convertTransitionDefinition, getInstantTransition) {\r\n    var resolvedTransition;\r\n    if (typeof transition === 'function') {\r\n        resolvedTransition = transition(props);\r\n    }\r\n    else if (transition[key] || transition.default) {\r\n        var keyTransition = transition[key] || transition.default;\r\n        if (typeof keyTransition === 'function') {\r\n            resolvedTransition = keyTransition(props);\r\n        }\r\n        else {\r\n            resolvedTransition = keyTransition;\r\n        }\r\n    }\r\n    else {\r\n        resolvedTransition = transition;\r\n    }\r\n    return resolvedTransition === false\r\n        ? getInstantTransition(value, props)\r\n        : convertTransitionDefinition(value, resolvedTransition, props);\r\n};\r\nvar findInsertionIndex = function (poseList, priorityList, priorityIndex) {\r\n    var insertionIndex = 0;\r\n    for (var i = priorityIndex - 1; i >= 0; i--) {\r\n        var nextHighestPriorityIndex = poseList.indexOf(priorityList[i]);\r\n        if (nextHighestPriorityIndex !== -1) {\r\n            insertionIndex = nextHighestPriorityIndex + 1;\r\n            break;\r\n        }\r\n    }\r\n    return insertionIndex;\r\n};\r\nvar createPoseSetter = function (setterProps) {\r\n    var state = setterProps.state, poses = setterProps.poses, startAction = setterProps.startAction, stopAction = setterProps.stopAction, getInstantTransition = setterProps.getInstantTransition, addActionDelay = setterProps.addActionDelay, getTransitionProps = setterProps.getTransitionProps, resolveTarget = setterProps.resolveTarget, transformPose = setterProps.transformPose, posePriority = setterProps.posePriority, convertTransitionDefinition = setterProps.convertTransitionDefinition;\r\n    return function (next, nextProps, propagate) {\r\n        if (nextProps === void 0) { nextProps = {}; }\r\n        if (propagate === void 0) { propagate = true; }\r\n        var children = state.children, values = state.values, props = state.props, activeActions = state.activeActions, activePoses = state.activePoses;\r\n        var _a = nextProps.delay, delay = _a === void 0 ? 0 : _a;\r\n        var hasChildren = children.size;\r\n        var baseTransitionProps = tslib_1.__assign({}, props, nextProps);\r\n        var nextPose = poses[next];\r\n        var getChildAnimations = function () {\r\n            return hasChildren && propagate\r\n                ? startChildAnimations(children, next, nextPose, baseTransitionProps)\r\n                : [];\r\n        };\r\n        var getParentAnimations = function () {\r\n            if (!nextPose)\r\n                return [];\r\n            if (transformPose)\r\n                nextPose = transformPose(nextPose, next, state);\r\n            var preTransition = nextPose.preTransition, getTransition = nextPose.transition;\r\n            if (preTransition)\r\n                preTransition(baseTransitionProps);\r\n            return Object.keys(getPoseValues(nextPose)).map(function (key) {\r\n                var valuePoses = activePoses.has(key)\r\n                    ? activePoses.get(key)\r\n                    : (activePoses.set(key, []), activePoses.get(key));\r\n                var existingIndex = valuePoses.indexOf(next);\r\n                if (existingIndex !== -1)\r\n                    valuePoses.splice(existingIndex, 1);\r\n                var priority = posePriority ? posePriority.indexOf(next) : 0;\r\n                var insertionIndex = priority <= 0\r\n                    ? 0\r\n                    : findInsertionIndex(valuePoses, posePriority, priority);\r\n                valuePoses.splice(insertionIndex, 0, next);\r\n                return insertionIndex === 0\r\n                    ? new Promise(function (complete) {\r\n                        var value = values.get(key);\r\n                        var transitionProps = tslib_1.__assign({}, baseTransitionProps, { key: key,\r\n                            value: value });\r\n                        var target = resolveTarget(value, resolveProp(nextPose[key], transitionProps));\r\n                        if (activeActions.has(key))\r\n                            stopAction(activeActions.get(key));\r\n                        var resolveTransitionProps = tslib_1.__assign({ to: target }, transitionProps, getTransitionProps(value, target, transitionProps));\r\n                        var transition = resolveTransition(getTransition, key, value, resolveTransitionProps, convertTransitionDefinition, getInstantTransition);\r\n                        var poseDelay = resolveProp(nextPose.delay, transitionProps);\r\n                        if (delay || poseDelay) {\r\n                            transition = addActionDelay(delay || poseDelay, transition);\r\n                        }\r\n                        activeActions.set(key, startAction(value, transition, complete));\r\n                    })\r\n                    : Promise.resolve();\r\n            });\r\n        };\r\n        if (nextPose && hasChildren) {\r\n            if (resolveProp(nextPose.beforeChildren, baseTransitionProps)) {\r\n                return Promise.all(getParentAnimations()).then(function () {\r\n                    return Promise.all(getChildAnimations());\r\n                });\r\n            }\r\n            else if (resolveProp(nextPose.afterChildren, baseTransitionProps)) {\r\n                return Promise.all(getChildAnimations()).then(function () {\r\n                    return Promise.all(getParentAnimations());\r\n                });\r\n            }\r\n        }\r\n        return Promise.all(getParentAnimations().concat(getChildAnimations()));\r\n    };\r\n};\r\nexport default createPoseSetter;\r\n//# sourceMappingURL=setter.js.map","map":"{\"version\":3,\"file\":\"setter.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/factories/setter.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/mattperry/Sites/popmotion/packages/pose-core/factories/setter.d.ts","text":"import { Props, PoserState, PoseMap, GetTransitionProps, GetInstantTransition, StartAction, StopAction, ResolveTarget, TransformPose, AddTransitionDelay, ConvertTransitionDefinition } from '../types';\r\ndeclare type SetterFactoryProps<V, A, C, P> = {\r\n    state: PoserState<V, A, C, P>;\r\n    poses: PoseMap<A>;\r\n    getInstantTransition: GetInstantTransition<V, A>;\r\n    startAction: StartAction<V, A, C>;\r\n    stopAction: StopAction<C>;\r\n    addActionDelay: AddTransitionDelay<A>;\r\n    getTransitionProps: GetTransitionProps<V>;\r\n    resolveTarget: ResolveTarget<V>;\r\n    convertTransitionDefinition: ConvertTransitionDefinition<V, A>;\r\n    transformPose?: TransformPose<V, A, C, P>;\r\n    posePriority?: string[];\r\n};\r\nexport declare const resolveProp: (target: any, props: Props) => any;\r\ndeclare const createPoseSetter: <V, A, C, P>(setterProps: SetterFactoryProps<V, A, C, P>) => (next: string, nextProps?: Props, propagate?: boolean) => Promise<any[]>;\r\nexport default createPoseSetter;\r\n"}}
